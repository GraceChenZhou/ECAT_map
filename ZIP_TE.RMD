---
title: "Predictions of Rapid Cystic Fibrosis Lung Disease Progression Informed by Socioeconomic Deprivation and Traffic-Related Air Pollution Exposure"
subtitle: 'Example Plot of Total Effect: Downtown area'
author: "Grace C. Zhou"
date:   'Update: `r format(Sys.Date(), "%B %d, %Y")`'
header-includes:
   - \usepackage{bbm}
output:
  html_document: 
    df_print: paged
    code_folding: hide
    toc: true
    toc_depth: 3
    toc_float: true
    number_sections: TRUE
    fig_caption: yes
    theme: flatly
bibliography: ECAT_refs.bib
link-citations: yes
---

```{r setup,echo=FALSE,warning = FALSE, message= FALSE}

knitr::opts_chunk$set(cache = FALSE, 
                      warning = FALSE, message= FALSE)

library(rmarkdown)
library(dplyr)
library(tmap)
library(leaflet)

indata <- readRDS('subData_TE.rds')
Cincy.zip <- readRDS('Cincy_zip.rds')
`Zip Area`<- Cincy.zip

```

# Introduction

The plot was generated by the subset data for specific zip codes ONLY with a total of `r nrow(indata)` observations.

# Early Age (12.9 years old)


```{r early}

OVERALL=indata %>% select(.,starts_with("early_"),'ZCTA5CE10') %>%
  mutate(`ECAT`=round(early_eff_ecat,2),
         `Deprivation Index`=round(early_eff_depind,2),
         `Green`=round(early_eff_green,2),
         `Drive`=round(early_eff_drive,2),
         `Overall`=round(early_eff_total,2))


ECAT <- OVERALL %>% select(ECAT,geom)
DEP.INDEX <- OVERALL %>% select(`Deprivation Index`,geom)
GREEN.SPACE <- OVERALL %>% select(Green,geom)
DRIVE.TIME <- OVERALL %>% select(Drive,geom)


tmap_mode("view")
map.early <- tm_basemap('CartoDB.Positron') +
  tm_shape(OVERALL) +
  tm_polygons(col = 'Overall', palette = "-RdYlGn",
              border.col = 'white',interactive = TRUE,style = "cont", alpha=0.5,
              border.alpha = 0.7,lwd = .1, id='Overall',
              popup.vars=c('Zip Code'='ZCTA5CE10',
                           'ECAT'='ECAT',
                           'Dep. Index'='Deprivation Index',
                           'Green'='Green',
                           'Drive'='Drive'))+
  tm_shape(ECAT) +
  tm_polygons(col = 'ECAT', palette = "-RdYlGn",
              border.col = 'white',interactive = TRUE,
              style = "cont", alpha=0.5, 
              border.alpha = 0.7,lwd = .1, id='ECAT')+
  tm_shape(DEP.INDEX) +
  tm_polygons(col = 'Deprivation Index', 
              palette = "-RdYlGn",border.col = 'white',
              interactive = TRUE,style = "cont", alpha=0.5, 
              border.alpha = 0.7,lwd = .1, 
              id='Deprivation Index')+
  tm_shape(GREEN.SPACE) +
  tm_polygons(col = 'Green', 
              palette = "-RdYlGn",border.col = 'white',
              interactive = TRUE,style = "cont", alpha=0.5, 
              border.alpha = 0.7,lwd = .1, 
              id='Green')+
  tm_shape(DRIVE.TIME) +
  tm_polygons(col = 'Drive', 
              palette = "-RdYlGn",border.col = 'white',
              interactive = TRUE,style = "cont", alpha=0.5, 
              border.alpha = 0.7,lwd = .1, 
              id='Drive')+
  tm_shape(`Zip Area`)+
    tm_borders(col='dark gray')+
    tm_text('ZCTA5CE10',size=0.7)
   
map.early %>% 
  tmap_leaflet() %>% 
  leaflet::hideGroup('ECAT') %>%  
  leaflet::hideGroup('DEP.INDEX') %>% 
  leaflet::hideGroup('GREEN.SPACE') %>% 
  leaflet::hideGroup('DRIVE.TIME')  %>% 
  leaflet::addEasyButton(easyButton(
    icon='fa-globe',title='Reset Zoom',
    onClick = JS('function(btn,map){map.setZoom(11);}')
  )) %>% 
  leaflet::addEasyButton(easyButton(
    icon='fa-crosshairs',title='Locate Me',
    onClick=JS('function(btn,map){map.locate({setView:true});}')))



```
********************************************************************************

# Middle Age (16.3 years old)

```{r middle}

OVERALL=indata %>% select(.,starts_with("middle_"),'ZCTA5CE10') %>%
  mutate(`ECAT`=round(middle_eff_ecat,2),
         `Deprivation Index`=round(middle_eff_depind,2),
         `Green`=round(middle_eff_green,2),
         `Drive`=round(middle_eff_drive,2),
         `Overall`=round(middle_eff_total,2))


ECAT <- OVERALL %>% select(ECAT,geom)
DEP.INDEX <- OVERALL %>% select(`Deprivation Index`,geom)
GREEN.SPACE <- OVERALL %>% select(Green,geom)
DRIVE.TIME <- OVERALL %>% select(Drive,geom)


tmap_mode("view")
map.middle <- tm_basemap('CartoDB.Positron') +
  tm_shape(OVERALL) +
  tm_polygons(col = 'Overall', palette = "-RdYlGn",
              border.col = 'white',interactive = TRUE,
              style = "cont", alpha=0.5,
              border.alpha = 0.7,lwd = .1, id='Overall',
              popup.vars=c('Zip Code'='ZCTA5CE10',
                           'ECAT'='ECAT',
                           'Dep. Index'='Deprivation Index',
                           'Green'='Green',
                           'Drive'='Drive'))+
  tm_shape(ECAT) +
  tm_polygons(col = 'ECAT', palette = "-RdYlGn",
              border.col = 'white',interactive = TRUE,
              style = "cont", alpha=0.5, 
              border.alpha = 0.7,lwd = .1, id='ECAT')+
  tm_shape(DEP.INDEX) +
  tm_polygons(col = 'Deprivation Index', 
              palette = "-RdYlGn",border.col = 'white',
              interactive = TRUE,style = "cont", alpha=0.5, 
              border.alpha = 0.7,lwd = .1, 
              id='Deprivation Index')+
  tm_shape(GREEN.SPACE) +
  tm_polygons(col = 'Green', 
              palette = "-RdYlGn",border.col = 'white',
              interactive = TRUE,style = "cont", alpha=0.5, 
              border.alpha = 0.7,lwd = .1, 
              id='Green')+
  tm_shape(DRIVE.TIME) +
  tm_polygons(col = 'Drive', 
              palette = "-RdYlGn",border.col = 'white',
              interactive = TRUE,style = "cont", alpha=0.5, 
              border.alpha = 0.7,lwd = .1, 
              id='Drive')+
   tm_shape(`Zip Area`)+
    tm_borders(col='dark gray')+
    tm_text('ZCTA5CE10',size=0.7)

map.middle %>% 
  tmap_leaflet() %>% 
  leaflet::hideGroup('ECAT') %>%  
  leaflet::hideGroup('DEP.INDEX') %>% 
  leaflet::hideGroup('GREEN.SPACE') %>% 
  leaflet::hideGroup('DRIVE.TIME')  %>% 
  leaflet::addEasyButton(easyButton(
    icon='fa-globe',title='Reset Zoom',
    onClick = JS('function(btn,map){map.setZoom(11);}')
  )) %>% 
  leaflet::addEasyButton(easyButton(
    icon='fa-crosshairs',title='Locate Me',
    onClick=JS('function(btn,map){map.locate({setView:true});}')))

```
********************************************************************************

# Late Age (18.5 years old)

```{r late}

OVERALL=indata %>% select(.,starts_with("late_"),'ZCTA5CE10') %>%
  mutate(`ECAT`=round(late_eff_ecat,2),
         `Deprivation Index`=round(late_eff_depind,2),
         `Green`=round(late_eff_green,2),
         `Drive`=round(late_eff_drive,2),
         `Overall`=round(late_eff_total,2))


ECAT <- OVERALL %>% select(ECAT,geom)
DEP.INDEX <- OVERALL %>% select(`Deprivation Index`,geom)
GREEN.SPACE <- OVERALL %>% select(Green,geom)
DRIVE.TIME <- OVERALL %>% select(Drive,geom)


tmap_mode("view")
map.late <- tm_basemap('CartoDB.Positron') +
  tm_shape(OVERALL) +
  tm_polygons(col = 'Overall', palette = "-RdYlGn",
              border.col = 'white',interactive = TRUE,
              style = "cont", alpha=0.5,
              border.alpha = 0.7,lwd = .1, id='Overall',
              popup.vars=c('Zip Code'='ZCTA5CE10',
                           'ECAT'='ECAT',
                           'Dep. Index'='Deprivation Index',
                           'Green'='Green',
                           'Drive'='Drive'))+
  tm_shape(ECAT) +
  tm_polygons(col = 'ECAT', palette = "-RdYlGn",
              border.col = 'white',interactive = TRUE,
              style = "cont", alpha=0.5, 
              border.alpha = 0.7,lwd = .1, id='ECAT')+
  tm_shape(DEP.INDEX) +
  tm_polygons(col = 'Deprivation Index', 
              palette = "-RdYlGn",border.col = 'white',
              interactive = TRUE,style = "cont", alpha=0.5, 
              border.alpha = 0.7,lwd = .1, 
              id='Deprivation Index')+
  tm_shape(GREEN.SPACE) +
  tm_polygons(col = 'Green', 
              palette = "-RdYlGn",border.col = 'white',
              interactive = TRUE,style = "cont", alpha=0.5, 
              border.alpha = 0.7,lwd = .1, 
              id='Green')+
  tm_shape(DRIVE.TIME) +
  tm_polygons(col = 'Drive', 
              palette = "-RdYlGn",border.col = 'white',
              interactive = TRUE,style = "cont", alpha=0.5, 
              border.alpha = 0.7,lwd = .1, 
              id='Drive')+
   tm_shape(`Zip Area`)+
    tm_borders(col='dark gray')+
    tm_text('ZCTA5CE10',size=0.7)

map.late %>% 
  tmap_leaflet() %>% 
  leaflet::hideGroup('ECAT') %>%  
  leaflet::hideGroup('DEP.INDEX') %>% 
  leaflet::hideGroup('GREEN.SPACE') %>% 
  leaflet::hideGroup('DRIVE.TIME') %>% 
  leaflet::addEasyButton(easyButton(
    icon='fa-globe',title='Reset Zoom',
    onClick = JS('function(btn,map){map.setZoom(11);}')
  )) %>% 
  leaflet::addEasyButton(easyButton(
    icon='fa-crosshairs',title='Locate Me',
    onClick=JS('function(btn,map){map.locate({setView:true});}')))
  

```
********************************************************************************

# Acknowledgement

The author is grateful to all of helps and supports from the team group: Andrew Vancil, Richard (Cole) Brokamp, Emrah Gecili, Rhonda Szczesniak, etc.   

# Notes

* This .html file was executed by R version 4.0.2 (2020-06-22)[@r_r_2020] with R package **tmap V3.3-2**[@tennekes_tmap_2018], **rmarkdown V2.9**[@allaire_rmarkdown_2021], **dplyr V1.0.5**[@wickham_dplyr_2021], **leaflet V2.0.4.1**[@cheng_leaflet_2021]. 

# References


